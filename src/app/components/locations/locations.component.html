<div class="flexCol">
  <div class="flexRow">
    <h1 class="title">Locations</h1>
  </div>
  <div class="flexRow">
    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      class="loc-tabla mat-elevation-z8"
    >
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
        <td mat-cell *matCellDef="let element">{{ element.name }}</td>
      </ng-container>

      <ng-container matColumnDef="address">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Address</th>
        <td mat-cell *matCellDef="let element">{{ element.address }}</td>
      </ng-container>

      <ng-container matColumnDef="coordinates">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Coordinates</th>
        <td mat-cell *matCellDef="let element">
          {{ element.coordinates.latitude }} ,
          {{ element.coordinates.longitude }}
        </td>
      </ng-container>

      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <div class="flexRow">
            Category
            <mat-form-field>
              <input
                matInput
                class="form-field"
                [formControl]="categoryFilter"
                placeholder="Category Filter"
              />
            </mat-form-field>
            <button
              class="grid-view-header-menu"
              mat-icon-button
              [matMenuTriggerFor]="menu"
            >
              <mat-icon>menu</mat-icon>
            </button>

            <mat-menu #menu>
              <button mat-menu-item (click)="groupBy()">
                Group By This Field
              </button>
              <button mat-menu-item (click)="unGroupBy()">Ungroup</button>
            </mat-menu>
          </div>
        </th>

        <td mat-cell *matCellDef="let element">
          {{ element.category.name }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        (click)="clickedRow(row)"
        *matRowDef="let row; columns: displayedColumns"
      ></tr>

      <!-- Group header -->
      <ng-container matColumnDef="groupHeader">
        <td mat-cell colspan="999" *matCellDef="let group">
          <!-- <mat-icon *ngIf="group.expanded">expand_less </mat-icon>
        <mat-icon *ngIf="!group.expanded">expand_more</mat-icon> -->
          <strong
            >{{ groupByColumns[group.level - 1] }} =
            {{ group[groupByColumns[group.level - 1]].name }} ({{
              group.totalCounts
            }})
          </strong>
        </td>
      </ng-container>
      <tr
        mat-row
        *matRowDef="let row; columns: ['groupHeader']; when: isGroup"
        (click)="groupHeaderClick(row)"
      ></tr>
    </table>
  </div>

  <div *ngIf="this.locationService.chooseLocation$ | async" class="flexRow">
    <app-maps
      class="location-map"
      [latitude]="this.myLatitude"
      [longitude]="this.myLongitude"
    ></app-maps>
  </div>
</div>
